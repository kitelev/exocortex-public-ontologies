---
layout: default
title: SPARQL Query Interface
---

<h1>SPARQL Query Interface</h1>

<p>Execute SPARQL queries against the ontology data ({{ site.data.stats.total_triples | default: "30,000+" }} triples).</p>

<div id="loading-status" style="padding: 10px; background: #e3f2fd; border-radius: 4px; margin-bottom: 20px;">
  <span id="status-icon">⏳</span> <span id="status-text">Loading ontology data...</span>
</div>

<h3>Example Queries</h3>
<div style="margin-bottom: 10px;">
  <strong>Basic:</strong>
  <button class="example-btn" data-query="classes">Classes</button>
  <button class="example-btn" data-query="properties">Properties</button>
  <button class="example-btn" data-query="subclasses">Subclass Tree</button>
  <button class="example-btn" data-query="domains">Domain/Range</button>
</div>
<div style="margin-bottom: 10px;">
  <strong>Ontologies:</strong>
  <button class="example-btn" data-query="schema">Schema.org</button>
  <button class="example-btn" data-query="foaf">FOAF</button>
  <button class="example-btn" data-query="skos">SKOS</button>
  <button class="example-btn" data-query="prov">PROV-O</button>
</div>
<div style="margin-bottom: 10px;">
  <strong>Analytics:</strong>
  <button class="example-btn" data-query="stats">Type Stats</button>
  <button class="example-btn" data-query="comments">With Comments</button>
  <button class="example-btn" data-query="inverse">Inverse Props</button>
</div>
<div style="margin-bottom: 10px;">
  <strong>CONSTRUCT:</strong>
  <button class="example-btn" data-query="construct_foaf">FOAF Graph</button>
  <button class="example-btn" data-query="construct_hierarchy">Class Hierarchy</button>
  <button class="example-btn" data-query="describe">DESCRIBE</button>
</div>
<div style="margin-bottom: 20px;">
  <strong>ASK:</strong>
  <button class="example-btn" data-query="ask_class">Has owl:Class?</button>
  <button class="example-btn" data-query="ask_label">Label Exists?</button>
  <button class="example-btn" data-query="ask_deprecated">Any Deprecated?</button>
</div>

<h3>Query</h3>
<textarea id="query-input" rows="12" style="width: 100%; font-family: monospace; font-size: 14px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT ?class ?label
WHERE {
  ?class a owl:Class .
  OPTIONAL { ?class rdfs:label ?label }
}
LIMIT 20</textarea>

<div style="margin: 15px 0;">
  <button id="run-btn" onclick="runQuery()" style="padding: 10px 20px; font-size: 16px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;" disabled>
    Run Query
  </button>
  <button id="export-btn" onclick="exportCSV()" style="padding: 10px 20px; font-size: 16px; background: #43a047; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px; display: none;">
    Export CSV
  </button>
  <span id="query-time" style="margin-left: 15px; color: #666;"></span>
</div>

<h3>Results</h3>
<div id="results-container" style="overflow-x: auto;">
  <table id="results-table" style="width: 100%; border-collapse: collapse; display: none;">
    <thead id="results-head" style="background: #f5f5f5;"></thead>
    <tbody id="results-body"></tbody>
  </table>
  <div id="results-message" style="padding: 20px; color: #666;">Run a query to see results</div>
</div>

<h3>Prefixes Reference</h3>
<details>
  <summary style="cursor: pointer; color: #1976d2;">Show common prefixes</summary>
  <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; font-size: 12px; overflow-x: auto;">
PREFIX rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;
PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;
PREFIX owl: &lt;http://www.w3.org/2002/07/owl#&gt;
PREFIX xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt;
PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt;
PREFIX dcterms: &lt;http://purl.org/dc/terms/&gt;
PREFIX skos: &lt;http://www.w3.org/2004/02/skos/core#&gt;
PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
PREFIX prov: &lt;http://www.w3.org/ns/prov#&gt;
PREFIX time: &lt;http://www.w3.org/2006/time#&gt;
PREFIX schema: &lt;http://schema.org/&gt;
PREFIX dcat: &lt;http://www.w3.org/ns/dcat#&gt;
PREFIX org: &lt;http://www.w3.org/ns/org#&gt;
PREFIX vcard: &lt;http://www.w3.org/2006/vcard/ns#&gt;
PREFIX geo: &lt;http://www.w3.org/2003/01/geo/wgs84_pos#&gt;
PREFIX sh: &lt;http://www.w3.org/ns/shacl#&gt;
PREFIX as: &lt;https://www.w3.org/ns/activitystreams#&gt;
PREFIX sioc: &lt;http://rdfs.org/sioc/ns#&gt;
PREFIX doap: &lt;http://usefulinc.com/ns/doap#&gt;
PREFIX sosa: &lt;http://www.w3.org/ns/sosa/&gt;
PREFIX qudt: &lt;http://qudt.org/schema/qudt/&gt;
PREFIX geosparql: &lt;http://www.opengis.net/ont/geosparql#&gt;
PREFIX adms: &lt;http://www.w3.org/ns/adms#&gt;
PREFIX vann: &lt;http://purl.org/vocab/vann/&gt;
  </pre>
</details>

<!-- Comunica SPARQL Engine (official build from rdf.js.org) -->
<script src="https://rdf.js.org/comunica-browser/versions/v4/engines/query-sparql/comunica-browser.js"></script>

<script>
// Example queries
const EXAMPLES = {
  classes: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT ?class ?label ?comment
WHERE {
  { ?class a owl:Class } UNION { ?class a rdfs:Class }
  OPTIONAL { ?class rdfs:label ?label . FILTER(LANG(?label) = "en" || LANG(?label) = "") }
  OPTIONAL { ?class rdfs:comment ?comment . FILTER(LANG(?comment) = "en" || LANG(?comment) = "") }
}
ORDER BY ?class
LIMIT 50`,

  properties: `PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT ?property ?type ?label
WHERE {
  ?property a ?type .
  FILTER(?type IN (rdf:Property, owl:ObjectProperty, owl:DatatypeProperty, owl:AnnotationProperty))
  OPTIONAL { ?property rdfs:label ?label }
}
ORDER BY ?type ?property
LIMIT 50`,

  subclasses: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?child ?parent
WHERE {
  ?child rdfs:subClassOf ?parent .
  FILTER(isURI(?parent))
}
ORDER BY ?parent ?child
LIMIT 100`,

  domains: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?property ?domain ?range
WHERE {
  { ?property rdfs:domain ?domain } UNION { ?property rdfs:range ?range }
}
ORDER BY ?property
LIMIT 100`,

  schema: `PREFIX schema: <http://schema.org/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?class ?label ?comment
WHERE {
  ?class a rdfs:Class .
  FILTER(STRSTARTS(STR(?class), "http://schema.org/"))
  OPTIONAL { ?class rdfs:label ?label }
  OPTIONAL { ?class rdfs:comment ?comment }
}
ORDER BY ?label
LIMIT 50`,

  foaf: `PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?resource ?type ?label
WHERE {
  ?resource ?p ?o .
  FILTER(STRSTARTS(STR(?resource), "http://xmlns.com/foaf/"))
  ?resource a ?type .
  OPTIONAL { ?resource rdfs:label ?label }
}
ORDER BY ?type ?resource
LIMIT 50`,

  skos: `PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?resource ?type ?label
WHERE {
  ?resource a ?type .
  FILTER(STRSTARTS(STR(?resource), "http://www.w3.org/2004/02/skos/"))
  OPTIONAL { ?resource rdfs:label ?label }
}
ORDER BY ?type
LIMIT 50`,

  prov: `PREFIX prov: <http://www.w3.org/ns/prov#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

SELECT ?resource ?type ?label
WHERE {
  ?resource a ?type .
  FILTER(STRSTARTS(STR(?resource), "http://www.w3.org/ns/prov"))
  FILTER(?type IN (owl:Class, rdfs:Class, owl:ObjectProperty, owl:DatatypeProperty))
  OPTIONAL { ?resource rdfs:label ?label }
}
ORDER BY ?type ?resource
LIMIT 50`,

  stats: `PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?type (COUNT(?s) AS ?count)
WHERE {
  ?s a ?type .
}
GROUP BY ?type
ORDER BY DESC(?count)
LIMIT 30`,

  comments: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?resource ?comment
WHERE {
  ?resource rdfs:comment ?comment .
  FILTER(LANG(?comment) = "en" || LANG(?comment) = "")
}
LIMIT 30`,

  inverse: `PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?prop1 ?prop2
WHERE {
  ?prop1 owl:inverseOf ?prop2 .
}
ORDER BY ?prop1
LIMIT 50`,

  construct_foaf: `PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

CONSTRUCT {
  ?class rdf:type rdfs:Class .
  ?class rdfs:label ?label .
}
WHERE {
  ?class a rdfs:Class .
  FILTER(STRSTARTS(STR(?class), "http://xmlns.com/foaf/"))
  OPTIONAL { ?class rdfs:label ?label }
}
LIMIT 20`,

  construct_hierarchy: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>

CONSTRUCT {
  ?child rdfs:subClassOf ?parent .
}
WHERE {
  ?child rdfs:subClassOf ?parent .
  ?child a owl:Class .
  FILTER(isURI(?parent))
}
LIMIT 50`,

  describe: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

DESCRIBE <http://www.w3.org/2000/01/rdf-schema#Class>`,

  ask_class: `PREFIX owl: <http://www.w3.org/2002/07/owl#>

ASK {
  ?x a owl:Class .
}`,

  ask_label: `PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

ASK {
  foaf:Person rdfs:label ?label .
}`,

  ask_deprecated: `PREFIX owl: <http://www.w3.org/2002/07/owl#>

ASK {
  ?x owl:deprecated true .
}`
};

// Store last results for CSV export
let lastResults = null;
let lastVars = null;

let engine = null;
let store = null;

async function initEngine() {
  const statusIcon = document.getElementById('status-icon');
  const statusText = document.getElementById('status-text');
  const runBtn = document.getElementById('run-btn');
  const loadingStatus = document.getElementById('loading-status');

  try {
    statusText.textContent = 'Initializing SPARQL engine...';

    // Create Comunica engine
    engine = new Comunica.QueryEngine();

    statusText.textContent = 'Loading ontology data (this may take a moment)...';

    // Get the absolute URL for the N-Triples file
    const baseUrl = window.location.href.replace(/\/[^\/]*$/, '/');
    store = baseUrl + 'ontologies.nt';

    // Verify file is accessible
    const response = await fetch(store, { method: 'HEAD' });
    if (!response.ok) {
      throw new Error(`Failed to load data: ${response.status}`);
    }

    // Get file size for display
    const contentLength = response.headers.get('content-length');
    const sizeMB = contentLength ? (parseInt(contentLength) / (1024 * 1024)).toFixed(1) : '?';

    statusIcon.textContent = '✅';
    statusText.textContent = `Ready! Data source: ${sizeMB} MB. Run a query to load data.`;
    loadingStatus.style.background = '#e8f5e9';

    runBtn.disabled = false;
  } catch (e) {
    statusIcon.textContent = '❌';
    statusText.textContent = `Error: ${e.message}`;
    loadingStatus.style.background = '#ffebee';
    console.error(e);
  }
}

async function runQuery() {
  const queryInput = document.getElementById('query-input');
  const resultsHead = document.getElementById('results-head');
  const resultsBody = document.getElementById('results-body');
  const resultsTable = document.getElementById('results-table');
  const resultsMessage = document.getElementById('results-message');
  const queryTime = document.getElementById('query-time');
  const runBtn = document.getElementById('run-btn');

  const query = queryInput.value.trim();
  if (!query) return;

  runBtn.disabled = true;
  runBtn.textContent = 'Running...';
  queryTime.textContent = '';
  resultsMessage.textContent = 'Executing query...';
  resultsTable.style.display = 'none';
  document.getElementById('export-btn').style.display = 'none';

  const startTime = performance.now();

  // Detect query type
  const queryType = await engine.queryType(query, { sources: [store] });

  try {
    if (queryType === 'bindings') {
      // SELECT query
      const bindingsStream = await engine.queryBindings(query, { sources: [store] });
      const bindings = await bindingsStream.toArray();
      const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);

      if (bindings.length === 0) {
        resultsMessage.textContent = 'No results found.';
        queryTime.textContent = `(${elapsed}s)`;
        runBtn.disabled = false;
        runBtn.textContent = 'Run Query';
        return;
      }

      // Get variable names
      const vars = [...bindings[0].keys()].map(v => v.value);

      // Build header
      resultsHead.innerHTML = '<tr>' + vars.map(v =>
        `<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">${escapeHtml(v)}</th>`
      ).join('') + '</tr>';

      // Build body
      resultsBody.innerHTML = bindings.map(binding => {
        return '<tr style="border-bottom: 1px solid #eee;">' + vars.map(v => {
          const term = binding.get(v);
          const value = term ? formatTerm(term) : '';
          return `<td style="padding: 10px; word-break: break-all; max-width: 400px;">${value}</td>`;
        }).join('') + '</tr>';
      }).join('');

      resultsTable.style.display = 'table';
      resultsMessage.textContent = '';
      queryTime.textContent = `${bindings.length} results (${elapsed}s)`;

      // Store for CSV export
      lastResults = bindings;
      lastVars = vars;
      document.getElementById('export-btn').style.display = 'inline-block';

    } else if (queryType === 'quads') {
      // CONSTRUCT/DESCRIBE query
      const quadsStream = await engine.queryQuads(query, { sources: [store] });
      const quads = await quadsStream.toArray();
      const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);

      if (quads.length === 0) {
        resultsMessage.textContent = 'No triples constructed.';
        queryTime.textContent = `(${elapsed}s)`;
        runBtn.disabled = false;
        runBtn.textContent = 'Run Query';
        return;
      }

      // Build header for triples
      resultsHead.innerHTML = '<tr>' +
        '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Subject</th>' +
        '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Predicate</th>' +
        '<th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Object</th>' +
        '</tr>';

      // Build body
      resultsBody.innerHTML = quads.map(quad => {
        return '<tr style="border-bottom: 1px solid #eee;">' +
          `<td style="padding: 10px; word-break: break-all; max-width: 300px;">${formatTerm(quad.subject)}</td>` +
          `<td style="padding: 10px; word-break: break-all; max-width: 300px;">${formatTerm(quad.predicate)}</td>` +
          `<td style="padding: 10px; word-break: break-all; max-width: 300px;">${formatTerm(quad.object)}</td>` +
          '</tr>';
      }).join('');

      resultsTable.style.display = 'table';
      resultsMessage.textContent = '';
      queryTime.textContent = `${quads.length} triples (${elapsed}s)`;

      // Store for CSV export (as pseudo-bindings)
      lastVars = ['subject', 'predicate', 'object'];
      lastResults = quads.map(q => ({
        get: (v) => v === 'subject' ? q.subject : v === 'predicate' ? q.predicate : q.object
      }));
      document.getElementById('export-btn').style.display = 'inline-block';

    } else if (queryType === 'boolean') {
      // ASK query
      const result = await engine.queryBoolean(query, { sources: [store] });
      const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);

      // Display ASK result as a styled box
      const resultText = result ? '✅ YES (true)' : '❌ NO (false)';
      const bgColor = result ? '#e8f5e9' : '#ffebee';

      resultsMessage.innerHTML = `
        <div style="padding: 30px; text-align: center; background: ${bgColor}; border-radius: 8px; font-size: 24px; font-weight: bold;">
          ${resultText}
        </div>
      `;
      resultsMessage.style.color = '';
      queryTime.textContent = `ASK result (${elapsed}s)`;

      // No CSV export for ASK
      lastResults = null;
      lastVars = null;
      document.getElementById('export-btn').style.display = 'none';

    } else {
      resultsMessage.textContent = `Unsupported query type: ${queryType}`;
    }
  } catch (e) {
    resultsMessage.textContent = `Error: ${e.message}`;
    resultsMessage.style.color = '#c62828';
    console.error(e);
  }

  runBtn.disabled = false;
  runBtn.textContent = 'Run Query';
}

function formatTerm(term) {
  if (term.termType === 'NamedNode') {
    const uri = term.value;
    // Try to shorten with known prefixes
    const short = shortenUri(uri);
    return `<code title="${escapeHtml(uri)}">${escapeHtml(short)}</code>`;
  } else if (term.termType === 'Literal') {
    let value = escapeHtml(term.value);
    if (term.language) {
      return `"${value}"@${term.language}`;
    } else if (term.datatype && term.datatype.value !== 'http://www.w3.org/2001/XMLSchema#string') {
      const dtype = shortenUri(term.datatype.value);
      return `"${value}"^^${dtype}`;
    }
    return `"${value}"`;
  } else if (term.termType === 'BlankNode') {
    return `_:${escapeHtml(term.value)}`;
  }
  return escapeHtml(term.value);
}

function shortenUri(uri) {
  const prefixes = {
    'http://www.w3.org/1999/02/22-rdf-syntax-ns#': 'rdf:',
    'http://www.w3.org/2000/01/rdf-schema#': 'rdfs:',
    'http://www.w3.org/2002/07/owl#': 'owl:',
    'http://www.w3.org/2001/XMLSchema#': 'xsd:',
    'http://purl.org/dc/elements/1.1/': 'dc:',
    'http://purl.org/dc/terms/': 'dcterms:',
    'http://www.w3.org/2004/02/skos/core#': 'skos:',
    'http://xmlns.com/foaf/0.1/': 'foaf:',
    'http://www.w3.org/ns/prov#': 'prov:',
    'http://www.w3.org/2006/time#': 'time:',
    'http://schema.org/': 'schema:',
    'http://www.w3.org/ns/dcat#': 'dcat:',
    'http://www.w3.org/ns/org#': 'org:',
    'http://www.w3.org/2006/vcard/ns#': 'vcard:',
    'http://www.w3.org/2003/01/geo/wgs84_pos#': 'geo:',
    'http://www.w3.org/ns/shacl#': 'sh:',
    'https://www.w3.org/ns/activitystreams#': 'as:',
    'http://rdfs.org/sioc/ns#': 'sioc:',
    'http://usefulinc.com/ns/doap#': 'doap:',
    'http://www.w3.org/ns/sosa/': 'sosa:',
    'http://ogp.me/ns#': 'ogp:',
    'http://www.w3.org/ns/adms#': 'adms:',
    'http://purl.org/vocab/vann/': 'vann:',
    'http://rdfs.org/ns/void#': 'void:',
    'http://www.opengis.net/ont/geosparql#': 'geosparql:',
    'http://qudt.org/schema/qudt/': 'qudt:',
    'http://www.w3.org/2003/g/data-view#': 'grddl:'
  };

  for (const [prefix, short] of Object.entries(prefixes)) {
    if (uri.startsWith(prefix)) {
      return short + uri.slice(prefix.length);
    }
  }
  return uri;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Example button handlers
document.querySelectorAll('.example-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const queryName = btn.dataset.query;
    if (EXAMPLES[queryName]) {
      document.getElementById('query-input').value = EXAMPLES[queryName];
    }
  });
});

// Keyboard shortcut: Ctrl+Enter to run query
document.getElementById('query-input').addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 'Enter') {
    e.preventDefault();
    if (!document.getElementById('run-btn').disabled) {
      runQuery();
    }
  }
});

// CSV Export function
function exportCSV() {
  if (!lastResults || !lastVars) return;

  // Build CSV content
  const rows = [];

  // Header row
  rows.push(lastVars.join(','));

  // Data rows
  lastResults.forEach(binding => {
    const row = lastVars.map(v => {
      const term = binding.get(v);
      if (!term) return '';
      let value = term.value;
      // Escape quotes and wrap in quotes if contains comma/quote/newline
      if (value.includes(',') || value.includes('"') || value.includes('\n')) {
        value = '"' + value.replace(/"/g, '""') + '"';
      }
      return value;
    });
    rows.push(row.join(','));
  });

  const csv = rows.join('\n');

  // Download
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sparql-results.csv';
  a.click();
  URL.revokeObjectURL(url);
}

// Initialize on load
initEngine();
</script>

<style>
  #query-input:focus {
    outline: 2px solid #1976d2;
  }
  #run-btn:hover:not(:disabled) {
    background: #1565c0;
  }
  #run-btn:disabled {
    background: #bdbdbd;
    cursor: not-allowed;
  }
  #export-btn:hover {
    background: #388e3c;
  }
  code {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 13px;
  }
  .example-btn {
    margin: 2px;
    padding: 6px 10px;
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
  }
  .example-btn:hover {
    background: #e0e0e0;
  }
</style>
